# Application Identity no OAuth 2.0

A **identidade da aplica√ß√£o** √© um conceito essencial para a seguran√ßa no OAuth 2.0, especialmente para autenticar o client (aplica√ß√£o) junto ao Authorization Server.

---

## üß≠ O que √© Application Identity?

√â a maneira como uma aplica√ß√£o **prova quem ela √©** ao servidor de autoriza√ß√£o.

### Componentes principais:
- **Client ID**: Identificador p√∫blico da aplica√ß√£o.
- **Client Secret**: Credencial secreta usada para provar a identidade (confidential clients).
- **Authentication Method**: A forma como o client se autentica.

---

## üîí Tipos de aplica√ß√µes e identidade

| Tipo de aplica√ß√£o         | Identidade | Protege client secret?  | Exemplo de uso                       |
|---------------------------|------------|-------------------------|--------------------------------------|
| Public Client             | Fraca      | ‚ùå N√£o                  | SPA, mobile app                      |
| Confidential Client       | Forte      | ‚úÖ Sim                  | Backend com Spring, Node, etc.       |
| Credentialed Client (CC)  | Forte      | ‚úÖ Sim                  | Machine-to-machine / integra√ß√£o API  |

---

## üìå M√©todos de Autentica√ß√£o do Client

| M√©todo                     | Descri√ß√£o |
|----------------------------|-----------|
| [client_secret_basic](#client_secret_basic-padr√£o)     | Envia client ID e secret no header Authorization (base64) |
| [client_secret_post](#client_secret_post)      | Envia ID e secret no corpo da requisi√ß√£o |
| [client_secret_jwt](#client_secret_jwt)       | O client assina um JWT como prova de identidade |
| [private_key_jwt](#private_key_jwt)         | JWT assinado com chave privada assim√©trica |
| [none](#none)                    | Sem autentica√ß√£o (usado por public clients) |

---

## üîê Exemplos por m√©todo

- ### `client_secret_basic` (padr√£o)
  Envia client ID e secret no header Authorization (base64)
  ```http
  POST /token
  Authorization: Basic base64(client_id:client_secret)
  Content-Type: application/x-www-form-urlencoded

  grant_type=authorization_code
  code=abc123
  redirect_uri=https://client.com/callback
  ```


- ### `client_secret_post`
  Envia ID e secret no corpo da requisi√ß√£o
  ```http
  POST /token
  Content-Type: application/x-www-form-urlencoded

  grant_type=authorization_code
  code=abc123
  redirect_uri=https://client.com/callback
  client_id=my-client
  client_secret=my-secret
  ```

- ### `client_secret_jwt`
  O client [assina um JWT](#assinar-um-token) com o client_secret como chave `sim√©trica` (HMAC), como prova de identidade
  ```http
  POST /token
  Content-Type: application/x-www-form-urlencoded

  grant_type=client_credentials
  client_id=my-client
  client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer
  client_assertion=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
  ```
  Payload jwt:
  ```
  {
      "iss": "client_id",           // Quem est√° emitindo (o pr√≥prio client)
      "sub": "client_id",           // Quem est√° se autenticando (tamb√©m o client)
      "aud": "https://auth.server.com/token", (Authorization Server) // Destinatario
      "exp": 1712345678,            // Expira√ß√£o
      "iat": 1712345078,            // Emitido em
      "jti": "nonce-1234"           // ID √∫nico para prevenir replay
  }
  ```

- ### `private_key_jwt`
  JWT assinado com uma chave privada `assim√©trica` (RSA ou EC). 

  Exige chave p√∫blica registrada no Authorization Server.

  ```
  POST /token
  Content-Type: application/x-www-form-urlencoded

  grant_type=client_credentials
  client_id=my-client
  client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer
  client_assertion=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
  ```
  O client_assertion √© um JWT assinado com uma chave privada RSA/EC 
  ```
  {
    "iss": "my-client",
    "sub": "my-client",
    "aud": "https://auth.example.com/token",
    "exp": 1712345678,
    "iat": 1712345078,
    "jti": "nonce-1234"
  }
  ```

- ### `none`
  ```
  POST /token
  Content-Type: application/x-www-form-urlencoded

  grant_type=authorization_code
  client_id=public-client-app
  code=xyz123
  redirect_uri=https://public-client.com/callback
  ```


## Assinar um token

### O JWT √© assinado com o client_secret usando HMAC (algoritmo HS256, por exemplo) 

Isso significa que:

- O client pega o header e o payload do JWT.

- Usa o client_secret como chave para gerar um c√≥digo HMAC (a assinatura).

- Junta tudo no formato header.payload.signature.

### O Authorization Server valida 

O servidor que recebe o JWT:

- Usa o mesmo client_secret armazenado (j√° registrado anteriormente).

- Recalcula o HMAC e compara com a assinatura recebida.

- Se coincidir, autentica o client com sucesso.

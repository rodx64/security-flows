
# Por que n√£o √© poss√≠vel alterar um Access Token para obter mais permiss√µes?

Access Tokens no OAuth 2.0 s√£o protegidos com mecanismos de seguran√ßa fortes que impedem qualquer tentativa de manipula√ß√£o. Esta √© uma das garantias fundamentais do protocolo.

---

## üîê O que impede a modifica√ß√£o de um Access Token?

### 1. **Assinatura digital (Tokens JWT)**
- Access Tokens muitas vezes s√£o **JWTs** (JSON Web Tokens).
- S√£o compostos por tr√™s partes: `header.payload.signature`.
- A **assinatura √© gerada com um segredo ou chave privada**.
- Qualquer modifica√ß√£o no `payload`, como tentar alterar o `scope`, **invalida a assinatura**.

Exemplo:
```json
{
  "sub": "12345",
  "scope": "read:profile",
  "exp": 1710000000
}
```

Se tentar mudar para:
```json
{
  "sub": "12345",
  "scope": "read:profile write:admin",
  "exp": 1710000000
}
```

üî¥ O Resource Server rejeita porque a **assinatura n√£o confere mais**.

---

### 2. **Tokens opacos (n√£o-JWT)**
- Tokens opacos s√£o strings sem significado leg√≠vel (ex: `abf8sdf9sdf0sdf0...`).
- O Resource Server precisa consultar o Authorization Server (via introspec√ß√£o) para verificar:
  - Se o token √© v√°lido
  - Quais escopos est√£o autorizados

üîê Isso **impede qualquer modifica√ß√£o**, pois a verifica√ß√£o ocorre diretamente com o servidor.

---

### 3. **Scopes s√£o definidos e controlados pelo Authorization Server**
- O client pode solicitar escopos, mas quem decide √© o Authorization Server.
- O usu√°rio precisa **consentir explicitamente** os escopos durante a autoriza√ß√£o.

---

## üîÑ O que acontece se eu tentar editar um token?

| Tipo de Token | A√ß√£o | Resultado |
|---------------|------|-----------|
| JWT | Alterar escopo | ‚ùå Assinatura inv√°lida |
| Opaco | Alterar conte√∫do | ‚ùå Token desconhecido pelo servidor |
| Ambos | Usar escopo n√£o autorizado | ‚ùå Acesso negado (403) |

---

## ‚úÖ Medidas de seguran√ßa envolvidas

| Mecanismo                  | Protege contra |
|---------------------------|----------------|
| Assinatura digital        | Altera√ß√£o de payload |
| HTTPS                     | Intercepta√ß√£o em tr√¢nsito |
| PKCE                      | Roubo de authorization code |
| Escopo e consentimento    | Uso indevido de permiss√µes |
| `aud` (audi√™ncia)         | Reutiliza√ß√£o em APIs diferentes |
| Expira√ß√£o (`exp`)         | Uso indevido de tokens expirados |

---

## üìå Conclus√£o

Voc√™ **n√£o pode alterar um access token para ganhar mais permiss√µes** porque:

- Tokens s√£o assinados ou verificados contra o servidor.
- Escopos s√£o controlados pelo Authorization Server e requerem consentimento.
- Tentativas de manipula√ß√£o s√£o detectadas e rejeitadas imediatamente.

üîê **OAuth 2.0 foi projetado para garantir a integridade dos tokens e impedir esse tipo de ataque.**

---

## Recursos adicionais

- [RFC 7519 - JSON Web Token (JWT)](https://datatracker.ietf.org/doc/html/rfc7519)
- [OAuth 2.0 Security Best Practices](https://oauth.net/2/oauth-best-practices/)
